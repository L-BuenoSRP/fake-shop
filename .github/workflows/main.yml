name: CI-CD
on: #Especificação do evento(trigger)
  push:
    branches: ["main"]
  workflow_dispatch:

jobs: #Agrupamento de ações a ser executados
 CI:
   runs-on: ubuntu-latest #Runner (Onde irá executar a automação)
   steps: #Cada tarefa a ser executada
     - name: Obter o codigo
       uses: actions/checkout@v4.2.2
     - name: Login to Docker Hub
       uses: docker/login-action@v3
       with:
        username: ${{ vars.DOCKERHUB_USERNAME }}
        password: ${{ secrets.DOCKERHUB_TOKEN }}
     - name: Construcao e envio da imagem docker
       uses: docker/build-push-action@v6
       with:
        context: ./src
        push: true
        file: ./src/Dockerfile
        tags: buenodsev/fake-shop-desafio:latest
 CD:
   needs: CI #Dependência da execução do job CI
   runs-on: ubuntu-latest
   steps:
     - run: echo "Obter o codigo"
     - run: echo "Configurar o kubeconfig"
     - run: echo "Executar o apply"
